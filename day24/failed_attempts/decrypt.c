#include <stdio.h>
#include <stdint.h>
#include <string.h>

#define IN_BUF_SIZE 20
#define OUT_BUF_SIZE 4

void calc_hash(char *src_buf,int len,uint32_t *sink_buf)
{
	uint32_t blk_a0;
	uint32_t blk_a1;
	uint32_t blk_a2;
	uint32_t blk_a3;

	uint32_t blk_b0;
	uint32_t blk_b1;
	uint32_t blk_b2;
	uint32_t blk_b3;

	uint32_t i;
	char chr;
	
	blk_a0 = 0x68736168;
	blk_a1 = 0xdeadbeef;
	blk_a2 = 0x65726f6d;
	blk_a3 = 0xc00ffeee;

	blk_b0 = 0xc00ffeee;
	blk_b1 = 0x68736168;
	blk_b2 = 0xdeadbeef;
	blk_b3 = 0x65726f6d;

	i = 0;
	while (i < len) {
		chr = src_buf[i];
		blk_a1 = blk_b1 ^
		         ((uint32_t)chr *  i         & 0xffU ^ (uint32_t)chr |
		         ((uint32_t)chr * (i + 0x31) & 0xffU ^ (uint32_t)chr) << 0x18 |
		         ((uint32_t)chr * (i + 0x42) & 0xffU ^ (uint32_t)chr) << 0x10 |
		         ((uint32_t)chr * (i + 0xef) & 0xffU ^ (uint32_t)chr) << 8);
		blk_a2 = blk_b2 ^
		         ((uint32_t)chr *  i         & 0x5aU ^ (uint32_t)chr |
		         ((uint32_t)chr * (i + 0xc0) & 0xffU ^ (uint32_t)chr) << 0x18 |
		         ((uint32_t)chr * (i + 0x11) & 0xffU ^ (uint32_t)chr) << 0x10 |
		         ((uint32_t)chr * (i + 0xde) & 0xffU ^ (uint32_t)chr) << 8);
		blk_a3 = blk_b3 ^
		         ((uint32_t)chr *  i         & 0x22U ^ (uint32_t)chr |
		         ((uint32_t)chr * (i + 0xe3) & 0xffU ^ (uint32_t)chr) << 0x18 |
		         ((uint32_t)chr * (i + 0xde) & 0xffU ^ (uint32_t)chr) << 0x10 |
		         ((uint32_t)chr * (i + 0x0d) & 0xffU ^ (uint32_t)chr) << 8);
		blk_a0 = blk_b0 ^
		         ((uint32_t)chr *  i         & 0xefU ^ (uint32_t)chr |
		         ((uint32_t)chr * (i + 0x52) & 0xffU ^ (uint32_t)chr) << 0x18 |
		         ((uint32_t)chr * (i + 0x24) & 0xffU ^ (uint32_t)chr) << 0x10 |
		         ((uint32_t)chr * (i + 0x33) & 0xffU ^ (uint32_t)chr) << 8);
		i = i + 1;
		blk_b0 = blk_a0;
		blk_b3 = blk_a3;
		blk_b2 = blk_a2;
		blk_b1 = blk_a1;
	}

	sink_buf[0] = blk_a0;
	sink_buf[1] = blk_a1;
	sink_buf[2] = blk_a2;
	sink_buf[3] = blk_a3;

	//fwrite(sink_buf, 4, 4, stdout);

	return;
}


void decrypt(uint32_t *hash_buf) {
//	unsigned char enc_data_buf[32] = {0x20,0xe5,0xaf,0xe5,0x9d,0x31,0xac,0xa3,0xca,0x21,0x1e,0xc3,0x79,0xa6,0x73,0x23,0x5e,0xda,0xb6,0xa0,0x8d,0x2e,0xd3,0xb7,0xb6,0x6b,0x55,0x85,0x7e,0xc8,0x34,0x22};
//	unsigned char enc_data_buf[32] = {0xfe,0x48,0x11,0x0a,0x43,0x9c,0x12,0x4c,0x14,0x8c,0xa0,0x2c,0xa7,0x0b,0xcd,0xcc,0x80,0x77,0x08,0x4f,0x53,0x83,0x6d,0x58,0x68,0xc6,0xeb,0x6a,0xa0,0x65,0x8a,0xcd};
//	unsigned char enc_data_buf[32] = {0xcf,0x5b,0x02,0x3b,0x72,0x8f,0x01,0x7d,0x25,0x9f,0xb3,0x1d,0x96,0x18,0xde,0xfd,0xb1,0x64,0x1b,0x7e,0x62,0x90,0x7e,0x69,0x59,0xd5,0xf8,0x5b,0x91,0x76,0x99,0xfc};

	unsigned char enc_data_buf[32] = {0x0a,0x11,0x48,0x43,0xde,0x12,0x0e,0x14,0xce,0xa0,0x6e,0xa7,0x49,0xcd,0x8e,0x80,0x35,0x08,0x0d,0x53,0xc1,0x6d,0x1a,0x68,0x84,0xeb,0x28,0xa0,0x27,0x8a,0x8f,0xa4};

//	unsigned char enc_data_buf[32] = {0x3b,0x02,0x5b,0x72,0xef,0x01,0x1d,0x25,0xff,0xb3,0x7d,0x96,0x78,0xde,0x9d,0xb1,0x04,0x1b,0x1e,0x62,0xf0,0x7e,0x09,0x59,0xb5,0xf8,0x3b,0x91,0x16,0x99,0x9c,0x95};

	unsigned char dec_data_buf[32] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

//	unsigned char enc_data_buf[86] = {0xa4,0xd6,0x09,0xb4,0x40,0xf6,0xac,0x2f,0x00,0x3b,0x26,0x3a,0x1a,0xee,0x7a,0x7d,0x83,0xd7,0x0a,0xfd,0x15,0xe5,0xbd,0x2e,0x01,0x2b,0x33,0x2b,0x44,0xed,0x22,0x60,0xa1,0xb3,0x39,0x84,0x34,0xd8,0x91,0x4c,0x3d,0x4b,0x4a,0x1c,0x3a,0x89,0x12,0x5c,0xb0,0xe6,0x6b,0x94,0x36,0x8b,0x90,0x13,0x2d,0x0b,0x11,0x0b,0x2b,0xce,0x4a,0x5e,0xda,0x92,0x4f,0xad,0x49,0xb6,0xb9,0x78,0x49,0x37,0x61,0x7c,0x5a,0xae,0x3a,0x38,0xc0,0x8c,0x5e,0xe9,0x1e,0xcb};
//	unsigned char dec_data_buf[86] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

//    unsigned char enc_data_buf[50] = {0x13,0x37,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0xe5,0xaf,0xe5,0x9d,0x31,0xac,0xa3,0xca,0x21,0x1e,0xc3,0x79,0xa6,0x73,0x23,0x5e,0xda,0xb6,0xa0,0x8d,0x2e,0xd3,0xb7,0xb6,0x6b,0x55,0x85,0x7e,0xc8,0x34,0x22,0x7a,0x00,0x00,0x01,0x00,0x01};
//	unsigned char enc_data_buf[50] = {0xcd,0x9a,0xbf,0xef,0xde,0xac,0xbe,0xef,0xde,0xad,0xbe,0xef,0xfe,0x48,0x11,0x0a,0x43,0x9c,0x12,0x4c,0x14,0x8c,0xa0,0x2c,0xa7,0x0b,0xcd,0xcc,0x80,0x77,0x08,0x4f,0x53,0x83,0x6d,0x58,0x68,0xc6,0xeb,0x6a,0xa0,0x65,0x8a,0xcd,0xa4,0xad,0xbe,0xee,0xde,0xac};
//	unsigned char dec_data_buf[50] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

//	unsigned char enc_data_buf[7] = {0xde,0xe7,0xcd,0x12,0x92,0x04,0xbb};
//	unsigned char dec_data_buf[7] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00};
	
//	unsigned char enc_data_buf[19] = {0xfa,0xd0,0x9b,0x4b,0x8d,0x2b,0xf4,0xf5,0x87,0xcb,0x56,0x0c,0xd9,0x51,0xa0,0xb8,0xe5,0xeb,0xb9};
//	unsigned char dec_data_buf[19] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
	int  data_len = 32;

	unsigned char magic[10] = {0xde,0xad,0xbe,0xef,0xc0,0x12,0x34,0x56,0x78,0x9a};
	unsigned char hash_byte;
	unsigned char magic_byte;
	unsigned char key_byte;

	for(int i=0; i < data_len; i++) {
		hash_byte = ( hash_buf[(i % 16) / 4] >> (8 * (i % 4)) ) & 0xff;
		//printf("%02x ", hash_byte);
		magic_byte = magic[hash_byte % 10];
		//printf("%02x ", magic_byte);
		key_byte = hash_byte ^ magic_byte ^ (unsigned char) i;
		//printf("%02x ", key_byte);

		dec_data_buf[i] = key_byte ^ enc_data_buf[i];
	}

	fwrite(dec_data_buf, 1, data_len, stdout);
	printf("\n");
}


int main() {
	char str_buf[IN_BUF_SIZE];
	uint32_t hash_buf[OUT_BUF_SIZE];
	char c;
	int  i = 0;

	while ((c = getchar()) != EOF) {
		if (c == 0x0a) {
			str_buf[i] = 0x00;
			calc_hash(str_buf, i, hash_buf);
//			printf("\nPassword:%s\n", str_buf);
			decrypt(hash_buf);
			i = 0;
		} else {
			if (i < IN_BUF_SIZE) {
				str_buf[i] = c;
				i++;
			}
		}
	}

	return 0;
}
